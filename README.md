# Signature-based-and-Image-based-Malware-Detection-System


## Developed by : 
  #### Hayoun Fatima Zohra
  #### Ouaaqa Youssef
  #### Mohammed Bendahrass
  #### Aymane benahmed
  
                                                                                                                            


# Table of Contents
- [Introduction](#Introduction)
- [Tools](#Tools)
- [Models training](#Model_training)
  - [Signature based model](#Signature_based_model)
  - [Image based model](Image_based_model)
- [Backend](#Backend)
- [User Interface](#User_Interface)
- [Conclusion](#Conclusion)

# Introduction : 

In this project, we emphasize a hands-on approach where we will search for datasets containing both image and signature malware samples. and we will follow a structured machine learning pipeline, including data preprocessing, training multiple models, and evaluating their performance using metrics such as accuracy, precision, recall, and F1-score. By integrating MLOps practices throughout the process, for gaining valuable experience in managing the lifecycle of machine learning models in cybersecurity applications.

# Tools :
</br>

<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/612cf9a0-574d-4441-a11a-0ad98a3c5899" alt="Angular" width="200" align="left" style="margin-right: 15px;" /><strong>Angular :</strong> Angular is a TypeScript-based open-source front-end web application framework. It is used for building dynamic single-page applications (SPAs) where content is loaded dynamically without the need for full-page reloads.</br></br>





</br></br>


<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/f42cd2c8-eb1c-4c8f-9cab-e396399d9438" alt="MLops" width="200" align="left" style="margin-right: 15px;" />
 <strong>MLOps:</strong> MLOps, short for Machine Learning Operations, is the practice of integrating machine learning (ML) models into the software development lifecycle (SDLC). It aims to streamline the deployment, monitoring, and management of ML models in production environments.</br></br>
  </br></br>

<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/3ba9454e-9230-49d6-bb91-bdd320ddd8e3" alt="MLops" width="200" align="left" style="margin-right: 15px;" />
 <strong>MLflow:</strong> : MLflow is an open-source platform designed to manage the end-to-end machine learning lifecycle, including experimentation, reproducibility, and deployment. In this instance, we utilized MLflow to log and monitor various metrics, parameters, and artifacts during the model training phase.




</br></br>

<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/01100a7c-e06f-4af7-aef1-4c45e117aaf0" alt="CICD" width="200" align="left" style="margin-right: 15px;" />
<strong>GitHub (CI/CD): </strong>GitHub is a platform for hosting and sharing code repositories. CI/CD (Continuous Integration/Continuous Deployment) is a set of practices used to automate the process of integrating code changes into a shared repository (CI) and deploying code to production environments (CD) after passing automated tests.
</br></br>
</br></br>


<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/288cd02d-7e62-461c-b41f-82fbecaa5163" alt="Angular" width="200" align="left" style="margin-right: 15px;" />
<strong>Scikit-learn (sklearn): </strong> Scikit-learn is an open-source machine learning library for Python. It provides simple and efficient tools for data mining and data analysis, built on NumPy, SciPy, and matplotlib. Scikit-learn features various classification, regression, and clustering algorithms, including support for model evaluation and data preprocessing. It is designed to interoperate with other Python libraries such as NumPy and pandas.</br></br>
</br></br>


<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/085c0db3-3b9f-4afd-8187-132d1ab33324" alt="A" width="200" align="left" style="margin-right: 15px;" />
<Strong>flask : </Strong>Flask is a lightweight and flexible web framework for Python that allows developers to build web applications quickly and easily. It's designed to be simple, with a minimalistic core, and it's highly extensible, making it easy to add features and functionality through a wide range of available extensions. Flask is often used for creating web APIs, microservices, and small to medium-sized web applications.

</br></br></br>
<img src="https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/8438d198-bb0e-4387-aef7-436dfbbad2dc" alt="r" width="200" align="left" style="margin-right: 15px;" />
<Strong>MongoDB : </Strong>MongoDB is a NoSQL database known for its high performance, scalability, and flexibility. It stores data in a document-oriented format, using JSON-like documents with dynamic schemas, which makes it well-suited for handling unstructured or semi-structured data.
</br></br></br>
# Models training :
## Signature based model
To train this model, we looked for a detailed dataset and we found one that containes PE file headers of diffrent legitimate and malwared files.
### Model Training
#### Step-by-Step Explanation
1. Data Loading and Initial Preparation
   - Load the dataset from a CSV file.
   - Rename columns for better readability.
   - Check the initial few rows, shape, and statistical description of the dataset.
   - Check for null values and remove duplicates.
2. Data Exploration and Visualization
   - Analyze the class distribution of the target variable (legitimate).
   - Visualize the class distribution using a bar plot.
3. Feature Selection
   - Drop unnecessary columns (Name, md5, legitimate).
   - Fit an ExtraTreesClassifier to identify important features.
   - Select important features based on the feature importances from the classifier.
4. Data Scaling
   - Apply standard scaling to the selected features to normalize the data.
5. Handling Class Imbalance
   - Use SMOTE (Synthetic Minority Over-sampling Technique) to balance the training data.
6. Model Training and Evaluation
   - Initialize three different models: Decision Tree, Random Forest, and XGBoost.
   - Perform cross-validation to evaluate the performance of each model.
   - Select the best model based on cross-validation scores.
   - Train the selected models on the training data and evaluate them on the test data.
   - Select the best performing model based on test data accuracy.
7. Saving the Model
   - Save the best model and the selected features using joblib and pickle.
  ### Extracting PE Headers
  To extract PE (Portable Executable) headers, we use the 'pefile' library, which allows us to parse PE files and extract relevant features.
  #### Functions for Extraction
  1. Entropy Calculation
     Calculates the entropy of data, which measures the randomness. Higher entropy indicates more randomness.
2. Resource Extraction
   Extracts resources from the PE file and calculates their entropy and size.
3. Version Info Extraction
   Extracts version information from the PE file.
4. Main Extraction Function
  Combines all the above functions to extract comprehensive information from the PE file.
  - the targeted pe headers:
    1. feature DllCharacteristics
    2. feature Characteristics
    3. feature Machine
    4. feature SectionsMaxEntropy
    5. feature Subsystem
    6. feature VersionInformationSize
    7. feature ImageBase
    8. feature MajorSubsystemVersion
    9. feature SizeOfOptionalHeader
    10. feature ResourcesMinEntropy
    11. feature ResourcesMaxEntropy
    12. feature SizeOfStackReserve
    13. feature MajorOperatingSystemVersion
  - to view the code look at the extract_PE_headers.py file
    
  ## Image based model

In our project, we're using machine learning to improve malware detection. We train our models in two ways: one, by looking at the unique signatures or patterns of known malware, and two, by analyzing the visual characteristics of malware samples converted into images. This dual approach helps us build a more effective system for identifying and classifying malware, even if it's never been seen before.

</br> 

### images data :


In this section, we describe the process of training machine learning models using the dataset containing images of malware and non-malware samples. We focus on two popular classifiers, Random Forest and Support Vector Machine (SVM), to classify the images and evaluate their performance.

</br>

#### using SVM :

<strong>SVM</strong>, or <strong>Support Vector Machine</strong>, is a supervised machine learning algorithm commonly employed for tasks involving classification and regression. It operates by identifying the hyperplane that most effectively segregates distinct classes within the feature space. We selected SVM for this project due to its 
effectiveness in determining whether an image represents malware or benign content.


At first, We collected a dataset consisting of images of malware and non-malware images. The images were preprocessed to extract relevant features using the Histogram of Oriented Gradients (HOG) method. The HOG method was chosen for its ability to capture important features from images. It converts images into histograms of gradient orientations, which are then used as input features for training the SVM model.


then The dataset was split into training and validation sets. To address class imbalance, we used the Synthetic Minority Over-sampling Technique (SMOTE) to generate synthetic samples of the minority class. The features were standardized using StandardScaler before training the SVM model.


After all, We evaluated the performance of the SVM model using metrics such as accuracy, precision, recall, F1-score, and ROC AUC.And We utilized MLflow to track the training process and log important metrics, parameters, and artifacts.
</br></br></br>

![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/6f3a7405-5eea-4fe4-b4fb-3b4f499f6847)
</br></br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/ce189b00-c070-44a9-bfcc-6ffe22d6cd34)

</br></br></br>
At the end The best-performing SVM model was saved using joblib for potential deployment in a production environment. Considerations for model deployment, such as 
scalability and reliability, were also discussed.</br>


#### using random Forest :
RandomForest is a supervised machine learning algorithm commonly employed for tasks involving classification and regression. It operates by constructing a multitude of decision trees during training and outputting the mode of the classes (classification) or mean prediction (regression) of the individual trees. We selected RandomForest for this project due to its effectiveness in determining whether an image represents malware or benign content.
</br>
We followed the same process for data collection and training with the SVM model. At the end, the best-performing RandomForest model was saved using joblib for potential deployment in a production environment.

### Experiment tracking :
xperiment tracking is the process of recording all the important components such as hyper parameters, metrics, models and artifacts like plots PNG images, files etc. Experiment tracking helps to reproduce the old results by using the stored parameters. Under one experiment different runs can be created and by changing the parameters value we can evaluate model performance. And easily do the model performance comparison and finalize the optimal model for production. MLFlow is the widely used tool for experiment tracking across organizations.
</br>
<srtong>Importance of MLflow in Our Project:</strong>
</b>
Reproducibility: Each experiment run is logged with all relevant details, making it easier to reproduce results.
Comparison: The metrics and parameters of different runs can be compared to identify the best model.
Versioning: Model versioning allows us to keep track of improvements and maintain a history of model performance.
Deployment: The tracked models can be easily deployed using MLflow's model deployment capabilities, ensuring a seamless transition from experimentation to production.
</br></br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/479e40f8-1fbe-42b2-b491-e7ee9174f4ce)

</br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/0d7a4f6e-593c-4993-8b3d-f7118ec7f6de)

</br></br>
The experiment is named RandomForest_Classification, clearly indicating the purpose of the experiment.
</br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/32e345f4-6ae5-4dbd-9565-67edc5b877a8)
</br></br></br>
</br>The parameters and metrics indicate that the RandomForest model has been well-tuned and performs effectively on the classification task. The high accuracy and precision values suggest that the model makes correct predictions most of the time. The recall value shows the model's ability to identify most of the positive instances. The F1-Score, being close to the precision and recall values, indicates a good balance between them. Lastly, the ROC AUC score demonstrates strong overall performance in distinguishing between the classes.
</br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/c0a3d9ee-5fd3-4106-9b94-0a2d2ed89a91)
the confusion matrix
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/35853773-c590-4679-8d91-b8878ffc7f06)
ROC and AUC curve
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/9d1d5491-2d5e-4cee-a9a2-8578eec67815)
and here we see that our model is successfully saved
We followed the same process for creating an experiment with the SVM model and saved this model using MLflow.
# Backend :
</br>
We utilized the Flask framework for the backend and MongoDB for the database due to MongoDB's flexibility with such data. Additionally, we loaded the machine learning model file using joblib.</br>
MongoDB is used to store prediction results. This allows for storing and retrieving predictions for later analysis.
</br>
Endpoints:
</br>
- predict: This endpoint accepts a POST request with an image file, processes the image, and returns a prediction (malware or benign).
- results: This endpoint retrieves all predictions stored in the MongoDB and returns them as JSON.
/: This endpoint renders a dashboard showing the count of malware and benign predictions.
</br></br></br>

![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/25bf1544-b70b-4c65-a5fc-ec4cde5c5967)
</br></br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/e9104559-6204-4996-9b4c-8f7e0bb749bc)

# Docker and containerization
</br>

- Backend containerization
  ![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/118858857/1e9b0f34-739b-4410-ab76-9e2c1fbb9433)

- Frontend containerization
  ![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/118858857/50c7b469-bcf0-4dde-84e1-4e4d8dc5c4b0)


<Strong></Strong>
# User Interface
</br>
he UI is designed to offer a clear and interactive way to explore different machine learning models used for detecting malware
It provideprovide : 
</br>
<strong>Random Forest Image: </strong>This button likely leads to a visualization or detailed explanation of how the Random Forest model processes and detects malware.
<strong>Support Vector Machine (SVM) Image: </strong>This button presumably directs to an image or detailed representation of the SVM model in action.
<Strong>Random Forest Signature:</Strong> This button might display signature-based detection mechanisms used by the Random Forest model.
<Strong>Support Vector Machine (SVM) Signature:</Strong> This button could show how the SVM model utilizes signature-based methods for malware detection.

![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/790a133e-5b56-4315-80a1-aa333013ec97)
</br></br></br>


Let's take an example of how it works with the Random Forest image
</br>
so after clicking on that button The interface provides a file selection option for users to upload an image file from their device as we can see here :</br></br>
</br></br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/5a01bd1c-e76a-4d97-a6c6-a07f1d25f343)


</br></br>
then it indicates whether the uploaded image is malware or not</br></br>
</br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/a04b5d4c-797b-4c52-a05a-7c8dcd5cac33)
</br></br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/128602766/835f8515-f442-45d9-aefa-4a0f2f73e9cf)
</br></br>


</br></br>
and the same aproache was followed with signatures, we need just to upload an "exe" and see if its a malware or not</br></br>
</br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/118858857/487d1595-f9dc-43c6-8ca7-87b90ea48633)
</br></br>
the case if the file is a malware</br></br>
</br>
![image](https://github.com/Youssefouaaqa/Signature-based-and-Image-based-Malware-Detection-System/assets/118858857/65373ea1-23f6-438d-b71c-edad54880055)
</br>

# conclusion :

</br>

In conclusion, this project successfully implemented a malware detection system using machine learning techniques. By extracting features from images and training a Random Forest classifier, we were able to achieve effective detection of malware. The use of SMOTE to address class imbalance and MLflow for experiment tracking and model management further enhanced the project's robustness and scalability. Overall, this project highlights the potential of machine learning in cybersecurity and provides a solid foundation for future research and development in this field.


